define(["@grafana/data","@grafana/runtime","lodash","rxjs","react","@grafana/ui"],((e,t,a,r,l,n)=>(()=>{var o={2781:(e,t,a)=>{var r=a(1433).Symbol;e.exports=r},6701:e=>{e.exports=function(e,t,a){switch(a.length){case 0:return e.call(t);case 1:return e.call(t,a[0]);case 2:return e.call(t,a[0],a[1]);case 3:return e.call(t,a[0],a[1],a[2])}return e.apply(t,a)}},1163:(e,t,a)=>{var r=a(6204),l=a(1256),n=a(6397),o=a(492),s=a(2845),i=a(7995),u=Object.prototype.hasOwnProperty;e.exports=function(e,t){var a=n(e),c=!a&&l(e),m=!a&&!c&&o(e),g=!a&&!c&&!m&&i(e),d=a||c||m||g,p=d?r(e.length,String):[],v=p.length;for(var h in e)!t&&!u.call(e,h)||d&&("length"==h||m&&("offset"==h||"parent"==h)||g&&("buffer"==h||"byteLength"==h||"byteOffset"==h)||s(h,v))||p.push(h);return p}},7148:(e,t,a)=>{var r=a(2781),l=a(7903),n=a(1738),o=r?r.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":o&&o in Object(e)?l(e):n(e)}},9250:(e,t,a)=>{var r=a(7148),l=a(2934);e.exports=function(e){return l(e)&&"[object Arguments]"==r(e)}},6567:(e,t,a)=>{var r=a(8446),l=a(8092),n=a(8953),o=a(1485),s=/^\[object .+?Constructor\]$/,i=Function.prototype,u=Object.prototype,c=i.toString,m=u.hasOwnProperty,g=RegExp("^"+c.call(m).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!n(e)||l(e))&&(r(e)?g:s).test(o(e))}},7129:(e,t,a)=>{var r=a(7148),l=a(3330),n=a(2934),o={};o["[object Float32Array]"]=o["[object Float64Array]"]=o["[object Int8Array]"]=o["[object Int16Array]"]=o["[object Int32Array]"]=o["[object Uint8Array]"]=o["[object Uint8ClampedArray]"]=o["[object Uint16Array]"]=o["[object Uint32Array]"]=!0,o["[object Arguments]"]=o["[object Array]"]=o["[object ArrayBuffer]"]=o["[object Boolean]"]=o["[object DataView]"]=o["[object Date]"]=o["[object Error]"]=o["[object Function]"]=o["[object Map]"]=o["[object Number]"]=o["[object Object]"]=o["[object RegExp]"]=o["[object Set]"]=o["[object String]"]=o["[object WeakMap]"]=!1,e.exports=function(e){return n(e)&&l(e.length)&&!!o[r(e)]}},1491:(e,t,a)=>{var r=a(8953),l=a(7499),n=a(8201),o=Object.prototype.hasOwnProperty;e.exports=function(e){if(!r(e))return n(e);var t=l(e),a=[];for(var s in e)("constructor"!=s||!t&&o.call(e,s))&&a.push(s);return a}},1506:(e,t,a)=>{var r=a(4796),l=a(5265),n=a(6805);e.exports=function(e,t){return n(l(e,t,r),e+"")}},7310:(e,t,a)=>{var r=a(3122),l=a(8559),n=a(4796),o=l?function(e,t){return l(e,"toString",{configurable:!0,enumerable:!1,value:r(t),writable:!0})}:n;e.exports=o},6204:e=>{e.exports=function(e,t){for(var a=-1,r=Array(e);++a<e;)r[a]=t(a);return r}},41:e=>{e.exports=function(e){return function(t){return e(t)}}},8109:(e,t,a)=>{var r=a(1433)["__core-js_shared__"];e.exports=r},8559:(e,t,a)=>{var r=a(9138),l=function(){try{var e=r(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();e.exports=l},5380:(e,t,a)=>{var r="object"==typeof a.g&&a.g&&a.g.Object===Object&&a.g;e.exports=r},9138:(e,t,a)=>{var r=a(6567),l=a(6772);e.exports=function(e,t){var a=l(e,t);return r(a)?a:void 0}},7903:(e,t,a)=>{var r=a(2781),l=Object.prototype,n=l.hasOwnProperty,o=l.toString,s=r?r.toStringTag:void 0;e.exports=function(e){var t=n.call(e,s),a=e[s];try{e[s]=void 0;var r=!0}catch(e){}var l=o.call(e);return r&&(t?e[s]=a:delete e[s]),l}},6772:e=>{e.exports=function(e,t){return null==e?void 0:e[t]}},2845:e=>{var t=/^(?:0|[1-9]\d*)$/;e.exports=function(e,a){var r=typeof e;return!!(a=null==a?9007199254740991:a)&&("number"==r||"symbol"!=r&&t.test(e))&&e>-1&&e%1==0&&e<a}},6220:(e,t,a)=>{var r=a(9316),l=a(8330),n=a(2845),o=a(8953);e.exports=function(e,t,a){if(!o(a))return!1;var s=typeof t;return!!("number"==s?l(a)&&n(t,a.length):"string"==s&&t in a)&&r(a[t],e)}},8092:(e,t,a)=>{var r,l=a(8109),n=(r=/[^.]+$/.exec(l&&l.keys&&l.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"";e.exports=function(e){return!!n&&n in e}},7499:e=>{var t=Object.prototype;e.exports=function(e){var a=e&&e.constructor;return e===("function"==typeof a&&a.prototype||t)}},8201:e=>{e.exports=function(e){var t=[];if(null!=e)for(var a in Object(e))t.push(a);return t}},3685:(e,t,a)=>{e=a.nmd(e);var r=a(5380),l=t&&!t.nodeType&&t,n=l&&e&&!e.nodeType&&e,o=n&&n.exports===l&&r.process,s=function(){try{return n&&n.require&&n.require("util").types||o&&o.binding&&o.binding("util")}catch(e){}}();e.exports=s},1738:e=>{var t=Object.prototype.toString;e.exports=function(e){return t.call(e)}},5265:(e,t,a)=>{var r=a(6701),l=Math.max;e.exports=function(e,t,a){return t=l(void 0===t?e.length-1:t,0),function(){for(var n=arguments,o=-1,s=l(n.length-t,0),i=Array(s);++o<s;)i[o]=n[t+o];o=-1;for(var u=Array(t+1);++o<t;)u[o]=n[o];return u[t]=a(i),r(e,this,u)}}},1433:(e,t,a)=>{var r=a(5380),l="object"==typeof self&&self&&self.Object===Object&&self,n=r||l||Function("return this")();e.exports=n},6805:(e,t,a)=>{var r=a(7310),l=a(3983)(r);e.exports=l},3983:e=>{var t=Date.now;e.exports=function(e){var a=0,r=0;return function(){var l=t(),n=16-(l-r);if(r=l,n>0){if(++a>=800)return arguments[0]}else a=0;return e.apply(void 0,arguments)}}},1485:e=>{var t=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return t.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},3122:e=>{e.exports=function(e){return function(){return e}}},3936:(e,t,a)=>{var r=a(1506),l=a(9316),n=a(6220),o=a(5405),s=Object.prototype,i=s.hasOwnProperty,u=r((function(e,t){e=Object(e);var a=-1,r=t.length,u=r>2?t[2]:void 0;for(u&&n(t[0],t[1],u)&&(r=1);++a<r;)for(var c=t[a],m=o(c),g=-1,d=m.length;++g<d;){var p=m[g],v=e[p];(void 0===v||l(v,s[p])&&!i.call(e,p))&&(e[p]=c[p])}return e}));e.exports=u},9316:e=>{e.exports=function(e,t){return e===t||e!=e&&t!=t}},4796:e=>{e.exports=function(e){return e}},1256:(e,t,a)=>{var r=a(9250),l=a(2934),n=Object.prototype,o=n.hasOwnProperty,s=n.propertyIsEnumerable,i=r(function(){return arguments}())?r:function(e){return l(e)&&o.call(e,"callee")&&!s.call(e,"callee")};e.exports=i},6397:e=>{var t=Array.isArray;e.exports=t},8330:(e,t,a)=>{var r=a(8446),l=a(3330);e.exports=function(e){return null!=e&&l(e.length)&&!r(e)}},492:(e,t,a)=>{e=a.nmd(e);var r=a(1433),l=a(659),n=t&&!t.nodeType&&t,o=n&&e&&!e.nodeType&&e,s=o&&o.exports===n?r.Buffer:void 0,i=(s?s.isBuffer:void 0)||l;e.exports=i},8446:(e,t,a)=>{var r=a(7148),l=a(8953);e.exports=function(e){if(!l(e))return!1;var t=r(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},3330:e=>{e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},8953:e=>{e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},2934:e=>{e.exports=function(e){return null!=e&&"object"==typeof e}},7995:(e,t,a)=>{var r=a(7129),l=a(41),n=a(3685),o=n&&n.isTypedArray,s=o?l(o):r;e.exports=s},5405:(e,t,a)=>{var r=a(1163),l=a(1491),n=a(8330);e.exports=function(e){return n(e)?r(e,!0):l(e)}},659:e=>{e.exports=function(){return!1}},7781:t=>{"use strict";t.exports=e},8531:e=>{"use strict";e.exports=t},2007:e=>{"use strict";e.exports=n},3241:e=>{"use strict";e.exports=a},5959:e=>{"use strict";e.exports=l},1269:e=>{"use strict";e.exports=r}},s={};function i(e){var t=s[e];if(void 0!==t)return t.exports;var a=s[e]={id:e,loaded:!1,exports:{}};return o[e](a,a.exports,i),a.loaded=!0,a.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var a in t)i.o(t,a)&&!i.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.nmd=e=>(e.paths=[],e.children||(e.children=[]),e);var u={};return(()=>{"use strict";i.r(u),i.d(u,{plugin:()=>k});var e=i(7781),t=i(8531),a=i(3241),r=i.n(a),l=i(3936),n=i.n(l),o=i(1269);const s={from:"${__from:date}",to:"${__to:date}",order:"Ascending",variablesNamesList:[""],variablesOptions:[],aggregateModesList:["None"],aliasesList:[""],aggregateTime:"None",where:{items:[],operators:[]},variablesNamesListOptions:[]},c={from:"${__from:date}",to:"${__to:date}",order:"Ascending",variablesNamesList:[""],variablesOptions:[],aggregateModesList:["None"],aliasesList:[""],aggregateTime:"None",where:{items:[],operators:[]},variablesNamesListOptions:[]},m=[{label:"=",value:"="},{label:"!=",value:"!="},{label:"<",value:"<"},{label:">",value:">"},{label:"<=",value:"<="},{label:">=",value:">="},{label:"includes",value:"includes"},{label:"not includes",value:"not includes"},{label:"starts with",value:"starts with"},{label:"ends with",value:"ends with"}],g=[{label:"and",value:"and"},{label:"or",value:"or"}],d=[{label:"Ascending",value:"Ascending"},{label:"Descending",value:"Descending"}],p=[{label:"None",value:"None"},{label:"First",value:"First"},{label:"Last",value:"Last"},{label:"Max",value:"Max"},{label:"Min",value:"Min"},{label:"Average",value:"Average"},{label:"Sum",value:"Sum"},{label:"Counter",value:"Counter"},{label:"Count",value:"Count"},{label:"StandardDeviation",value:"StandardDeviation"},{label:"Variance",value:"Variance"},{label:"TimeWeightedAverage",value:"TimeWeightedAverage"},{label:"Timer",value:"Timer"},{label:"Duration",value:"Duration"},{label:"Occurrence",value:"Occurrence"},{label:"MinWithTimestamp",value:"MinWithTimestamp"},{label:"MaxWithTimestamp",value:"MaxWithTimestamp"},{label:"FirstWithTimestamp",value:"FirstWithTimestamp"},{label:"LastWithTimestamp",value:"LastWithTimestamp"},{label:"PowerToEnergy",value:"PowerToEnergy"},{label:"EnergyToPower",value:"EnergyToPower"},{label:"FlowToAmount",value:"FlowToAmount"},{label:"AmountToFlow",value:"AmountToFlow"},{label:"ValueChanges",value:"ValueChanges"},{label:"StepDuration",value:"StepDuration"},{label:"MinMaxTrend",value:"MinMaxTrend"},{label:"Gantt",value:"Gantt"},{label:"GanttView",value:"GanttView"}],v=[{label:"None",value:"None"},{label:"First",value:"First"},{label:"Last",value:"Last"},{label:"Max",value:"Max"},{label:"Min",value:"Min"},{label:"Average",value:"Average"},{label:"Sum",value:"Sum"},{label:"Counter",value:"Counter"},{label:"Count",value:"Count"},{label:"StandardDeviation",value:"StandardDeviation"},{label:"Variance",value:"Variance"},{label:"TimeWeightedAverage",value:"TimeWeightedAverage"},{label:"Timer",value:"Timer"},{label:"Duration",value:"Duration"},{label:"Occurrence",value:"Occurrence"},{label:"MinWithTimestamp",value:"MinWithTimestamp"},{label:"MaxWithTimestamp",value:"MaxWithTimestamp"},{label:"FirstWithTimestamp",value:"FirstWithTimestamp"},{label:"LastWithTimestamp",value:"LastWithTimestamp"},{label:"PowerToEnergy",value:"PowerToEnergy"},{label:"EnergyToPower",value:"EnergyToPower"},{label:"FlowToAmount",value:"FlowToAmount"},{label:"AmountToFlow",value:"AmountToFlow"}],h=[{label:"None",value:"None"},{label:"1s",value:"1s"},{label:"2s",value:"2s"},{label:"3s",value:"3s"},{label:"4s",value:"4s"},{label:"5s",value:"5s"},{label:"10s",value:"10s"},{label:"15s",value:"15s"},{label:"20s",value:"20s"},{label:"25s",value:"25s"},{label:"30s",value:"30s"},{label:"45s",value:"45s"},{label:"1m",value:"1m"},{label:"2m",value:"2m"},{label:"3m",value:"3m"},{label:"4m",value:"4m"},{label:"5m",value:"5m"},{label:"10m",value:"10m"},{label:"15m",value:"15m"},{label:"20m",value:"20m"},{label:"30m",value:"30m"},{label:"1h",value:"1h"},{label:"2h",value:"2h"},{label:"6h",value:"6h"},{label:"8h",value:"8h"},{label:"12h",value:"12h"},{label:"1d",value:"1d"},{label:"10d",value:"10d"},{label:"30d",value:"30d"}],f={None:0,"1s":1e3,"2s":2e3,"3s":3e3,"4s":4e3,"5s":5e3,"10s":1e4,"15s":15e3,"20s":2e4,"25s":25e3,"30s":3e4,"45s":45e3,"1m":6e4,"2m":12e4,"3m":18e4,"4m":24e4,"5m":3e5,"10m":6e5,"15m":9e5,"20m":12e5,"30m":18e5,"1h":36e5,"2h":72e5,"6h":216e5,"8h":288e5,"12h":432e5,"1d":864e5,"10d":864e6,"30d":2592e6};function b(e,t,a,r,l,n,o){try{var s=e[n](o),i=s.value}catch(e){return void a(e)}s.done?t(i):Promise.resolve(i).then(r,l)}function y(e){return function(){var t=this,a=arguments;return new Promise((function(r,l){var n=e.apply(t,a);function o(e){b(n,r,l,o,s,"next",e)}function s(e){b(n,r,l,o,s,"throw",e)}o(void 0)}))}}function w(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function O(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),r.forEach((function(t){w(e,t,a[t])}))}return e}function T(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);a.push.apply(a,r)}return a}(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))})),e}class j extends e.DataSourceApi{initPlugin(){var e=this;return y((function*(){try{e.isRemote?(e.apiUrl=e.baseUrl+e.remoteRoute,yield e.getRemoteToken()):e.apiUrl=e.baseUrl+e.localRoute,yield e.createAssetMap(),yield e.createVariablesMap(),yield e.createVariablesOptions()}catch(e){console.log("initPlugin error: ",e)}}))()}getRemoteToken(){let e=this;return new Promise(((t,a)=>{let r=this.apiUrl+"/device/edge/api/v1/login/direct",l={"x-grafana-remotedevice":this.remoteConfigUrl};e.customRequest(r,l,"post",e.getRemoteTokenBody).then((a=>{e.remoteToken=a.data.access_token,e.remoteTokenExpire=a.data.expires_in-36e5,t(!0)}),(e=>{console.log("getremotetoken error:",e),a(e)}))}))}createAssetMap(){let e={},t="/AssetService/Assets";this.isRemote?(e={"x-grafana-remotedevice":this.remoteConfigUrl,"x-grafana-remotetoken":this.remoteToken},t=this.apiUrl+"/iih-essentials"+t):t=this.apiUrl+t;let a=this;return new Promise(((r,l)=>{a.customGetRequest(t,e).then((e=>{if(e.data.hasOwnProperty("assets")){let t={},l=[];for(let a=0;a<e.data.assets.length;a++){let r=e.data.assets[a];if(t[r.assetId.toString()]={hasParent:!1,parents:[],parentsNames:[],name:r.name,id:r.assetId.toString()},""!==r.parentId){let e=r.parentId.toString();t[r.assetId].hasParent=!0,t[r.assetId].parents.push(e)}l.push(r.assetId.toString())}for(let a=0;a<e.data.assets.length;a++){let r=e.data.assets[a];if(""!==r.parentId){let e=r.parentId.toString();for(;t[e].hasParent;)e=t[e].parents[t[e].parents.length-1],t[r.assetId].parents.unshift(e)}}for(let e=0;e<l.length;e++){let a=t[l[e]];if(a.hasParent)for(let e=0;e<a.parents.length;e++)a.parentsNames.push(t[a.parents[e]].name)}a.idAssetMaps=t,r(!0)}else console.log("No assets found."),r(!1)}),(e=>{console.log("createassetsmap error:",e),l(!1)}))}))}createVariablesMap(){let e={},t="/DataService/Variables";this.isRemote?(e={"x-grafana-remotedevice":this.remoteConfigUrl,"x-grafana-remotetoken":this.remoteToken},t=this.apiUrl+"/iih-essentials"+t):t=this.apiUrl+t;let a=this;return new Promise(((r,l)=>{a.customGetRequest(t,e).then((e=>{if(e.data.hasOwnProperty("variables")){for(let t=0;t<e.data.variables.length;t++){let r=this.idAssetMaps[e.data.variables[t].assetId],l="";r.hasParent&&(l=r.parentsNames.join(".")+"."),l+=r.name;let n=l+"."+e.data.variables[t].variableName;a.nameIdMaps[n]=e.data.variables[t].variableId,a.idNameMaps[e.data.variables[t].variableId]=n,a.nameTypeMaps[n]=e.data.variables[t].dataType}r(!0)}else console.log("No variables."),r(!1)}),(e=>{console.log("createvariablesmap error:",e),l(!1)}))}))}createVariablesOptions(){let e={},a="/DataService/Variables";this.isRemote?(e={"x-grafana-remotedevice":this.remoteConfigUrl,"x-grafana-remotetoken":this.remoteToken},a=this.apiUrl+"/iih-essentials"+a):a=this.apiUrl+a;let r=this;return r.variablesOptions=[],new Promise(((l,n)=>{let o=(0,t.getTemplateSrv)().getVariables();o.length>0&&r.variablesOptions.push({label:"Grafana Variables",value:"Grafana Variables",options:[]});for(let e=0;e<o.length;e++)if("custom"===o[e].type||"query"===o[e].type){let t=o[e].options.length;o[e].includeAll&&(t-=1);for(let a=0;a<t;a++)r.variablesOptions[0].options.push({label:"${"+o[e].name+"_"+a+"}",value:"${"+o[e].name+"_"+a+"}"})}else"constant"!==o[e].type&&"textbox"!==o[e].type||r.variablesOptions[0].options.push({label:"${"+o[e].name+"}",value:"${"+o[e].name+"}"});r.customGetRequest(a,e).then((e=>{if(e.data.hasOwnProperty("variables")){let t=[];for(let a=0;a<e.data.variables.length;a++){let r=this.idAssetMaps[e.data.variables[a].assetId],l="";r.hasParent&&(l=r.parentsNames.join(".")+"."),l+=r.name;let n=l+"."+e.data.variables[a].variableName;t.push({label:n,value:n})}t.sort(((e,t)=>"string"==typeof e.value&&"string"==typeof t.value?e.value.localeCompare(t.value):0)),r.variablesOptions=r.variablesOptions.concat(t),l(r.variablesOptions)}else console.log("No variables found."),l(r.variablesOptions)}),(e=>{console.log("createvariablesoptions error:",e),n(!1)}))}))}applyWhereClause(e,t,a){try{return"="===t?(e=void 0===e?"undefined":e).toString()===a.toString():"!="===t?(e=void 0===e?"undefined":e).toString()!==a.toString():"<"===t&&void 0!==e?Number(e)<Number(a):">"===t&&void 0!==e||"<="===t&&void 0!==e||">="===t&&void 0!==e?Number(e)>Number(a):"includes"===t&&void 0!==e?e.toString().includes(a.toString()):"not includes"===t&&void 0!==e?!e.toString().includes(a.toString()):"starts with"===t&&void 0!==e?e.toString().startsWith(a.toString()):"ends with"===t&&void 0!==e&&e.toString().endsWith(a.toString())}catch(e){console.log("applyWhereClause error: ",e)}}queryData(e,t,a,r,l,n){let o={},s="/DataService/Data";this.isRemote?(o={"x-grafana-remotedevice":this.remoteConfigUrl,"x-grafana-remotetoken":this.remoteToken},s=this.apiUrl+"/iih-essentials"+s):s=this.apiUrl+s;let i=this;return new Promise(((u,c)=>{const m=`variableIds=${a}&from=${r}&to=${l}&order=${n}`;i.customGetRequest(s,o,"json",m).then((a=>{let r=a.data.data,l=-1;for(let a=0;a<r.length;a++){let n=r[a].variableId+"_None";for(let o=0;o<r[a].values.length;o++)l=e.indexOf(r[a].values[o].timestamp),-1===l&&(e.push(r[a].values[o].timestamp),l=e.length-1),t[n][l]=r[a].values[o].value}a.data.hasOwnProperty("hasMoreData")?u({queryFinished:!1,queryFrom:a.data.hasMoreData.from,queryTo:a.data.hasMoreData.to,timeBuffer:e,dataBuffer:t}):u({queryFinished:!0,queryFrom:"",queryTo:"",timeBuffer:e,dataBuffer:t})}),(e=>{console.log("querydata error",e),c(!1)}))}))}queryDataAggregateTrend(e,t,a,r,l,n,o){let s={},i="/DataService/CalculateTrend",u=this.aggregateBaseBody;this.isRemote?(s={"x-grafana-remotedevice":this.remoteConfigUrl,"x-grafana-remotetoken":this.remoteToken},i=this.apiUrl+"/iih-essentials"+i):i=this.apiUrl+i;let c=this;return new Promise(((m,g)=>{const d=T(O({},u),{from:r,to:l,calculationTimeRange:o,dataSources:[]});for(let e=0;e<a.length;e++)d.dataSources.push({type:"Variable",id:a[e],aggregation:n[e]});c.customRequest(i,s,"post",d).then((a=>{let r=a.data,l=-1;for(let a=0;a<r.length;a++){let n=r[a].dataSource.id+"_"+r[a].dataSource.aggregation;for(let o=0;o<r[a].values.length;o++)l=e.indexOf(r[a].values[o].timestamp),-1===l&&(e.push(r[a].values[o].timestamp),l=e.length-1),t[n][l]=r[a].values[o].value}a.data.hasOwnProperty("hasMoreData")?m({queryFinished:!1,queryFrom:a.data.hasMoreData.from,queryTo:a.data.hasMoreData.to,timeBuffer:e,dataBuffer:t}):m({queryFinished:!0,queryFrom:"",queryTo:"",timeBuffer:e,dataBuffer:t})}),(e=>{console.log("querydataaggregatetrend error:",e),g(!1)}))}))}queryDataAggregate(e,t,a,r,l,n){let o={},s="/DataService/Calculate";this.isRemote?(o={"x-grafana-remotedevice":this.remoteConfigUrl,"x-grafana-remotetoken":this.remoteToken},s=this.apiUrl+"/iih-essentials"+s):s=this.apiUrl+s;let i=this;return new Promise(((u,c)=>{const m=T(O({},i.aggregateBaseBody),{from:r,to:l,dataSources:[]});for(let e=0;e<a.length;e++)m.dataSources.push({type:"Variable",id:a[e],aggregation:n[e]});i.customRequest(s,o,"post",m).then((a=>{let r=a.data,n=-1;for(let a=0;a<r.length;a++){let o=r[a].dataSource.id+"_"+r[a].dataSource.aggregation;n=e.indexOf(l),-1===n&&(0===e.length?(e[0]=l,n=0):n=e.length-1),t[o][n]=r[a].value}u({queryFinished:!0,timeBuffer:e,dataBuffer:t})}),(e=>{console.log("querydataaggregate error:",e),c(!1)}))}))}queryLoop(e,t,a,r,l,n,o){var s=this;return y((function*(){let i=r,u=l,c=e,m=t,g=["Data","Aggregate","AggregateTrend"];for(let e=0;e<g.length;e++){let t=g[e],r=!1;if("Data"===t){let e='["'+a.Data.variablesIdsList.join('","')+'"]';for(let t=1;!r&&t<99999;t++)yield s.delay(150),s.queryData(c,m,e,i,u,n).then((e=>{c=e.timeBuffer,m=e.dataBuffer,e.queryFinished?r=!0:(i=e.queryFrom,u=e.queryTo)})).catch((e=>console.log("queryloopdata error:",e)))}else if("AggregateTrend"===t)for(let e=1;!r&&e<99999;e++)yield s.delay(150),s.queryDataAggregateTrend(c,m,a.AggregateTrend.variablesIdsList,i,u,a.AggregateTrend.aggregateModesList,o).then((e=>{c=e.timeBuffer,m=e.dataBuffer,e.queryFinished?r=!0:(i=e.queryFrom,u=e.queryTo)})).catch((e=>console.log("queryloopaggregatetrend error:",e)));else"Aggregate"===t&&(yield s.delay(150),s.queryDataAggregate(c,m,a.Aggregate.variablesIdsList,i,u,a.Aggregate.aggregateModesList).then((e=>{c=e.timeBuffer,m=e.dataBuffer,e.queryFinished&&(r=!0)})).catch((e=>console.log("queryloopaggregate error:",e))))}return{timeBuffer:c,dataBuffer:m}}))()}query(a){var r=this;return y((function*(){const l=a.targets.map((o=y((function*(l){const o=n()(l,s);let i=[],u=!1;if(r.isRemote?(((new Date).getTime()>r.remoteTokenExpire||""===r.remoteToken)&&(yield r.getRemoteToken(),yield r.createAssetMap(),yield r.createVariablesMap(),yield r.createVariablesOptions()),""!==r.remoteToken&&(u=!0)):u=!0,u){let e=o.variablesNamesList,l=(0,t.getTemplateSrv)().replace(o.from,a.scopedVars),n=(0,t.getTemplateSrv)().replace(o.to,a.scopedVars),s="Descending"===o.order?"Descending":"Ascending",u=o.aliasesList,c=o.aggregateModesList,m=r.aggregateTimeMap[o.aggregateTime],g=o.where||{items:[],operators:[]},d=(0,t.getTemplateSrv)().getVariables(),p=yield r.createQueryProperties(e,d,c,m,u),v=p.queryGroups,h=p.queryVarNameList,f=p.queryVarIdList,b=p.queryVarTypeList,y=p.fieldNames,w=yield r.generateWhereClause(g,f,d),O=w.whereClauseActiveCheck,T=w.whereClauseActive;if(g=w.queryWhere,new Date(l).getTime()>0&&new Date(n).getTime()>0&&new Date(l).getTime()<new Date(n).getTime()&&y.length>0){l=new Date(l).toISOString(),n=new Date(n).getTime()>(new Date).getTime()?(new Date).toISOString():new Date(n).toISOString();let e={};h.map((t=>e[t]=[]));let t=[];const a=yield r.queryLoop(t,e,v,l,n,s,m);i=(yield r.formatQueryResult(i,a,h,f,b,s,v,O,T,g,y)).fields}}return new e.MutableDataFrame({refId:o.refId,fields:i})})),function(e){return o.apply(this,arguments)}));var o;return Promise.all(l).then((e=>({data:e})))}))()}createQueryProperties(e,t,a,r,l){return new Promise(((n,o)=>{let s={Data:{variablesIdsList:[]},Aggregate:{variablesIdsList:[],aggregateModesList:[]},AggregateTrend:{variablesIdsList:[],aggregateModesList:[]}},i=[],u=[],c=[],m=[];for(let n=0;n<e.length;n++){let o=e[n];if(""!==o&&void 0!==o&&"undefined"!==o&&null!==o){if(o.startsWith("${")&&o.endsWith("}")){let e=o.substring(2,o.length-1).split("_"),a=e.length>1?Number(e[e.length-1]):0,r=e.length>1?e.slice(0,-1).join("_"):e[0],l=t.filter((e=>e.name===r));if(!(l.length>0))break;if("textbox"===l[0].type||"constant"===l[0].type)o=l[0].current.value;else if("query"===l[0].type||"custom"===l[0].type){let e=l[0].options[l[0].includeAll?a+1:a];if(!e.selected)break;o=e.value}}let e=a[n],g=this.nameIdMaps[o],d=l[n];if(null==g||"undefined"===g||""===g)break;{let e=d.indexOf("${"),a=d.indexOf("}");if(-1!==e&&-1!==a){let r=d.substring(e+2,a).split("_"),l=r.length>1?Number(r[r.length-1]):-1,n=r.length>1?r.slice(0,-1).join("_"):r[0],o=t.filter((e=>e.name===n));if(o.length>0)if("textbox"===o[0].type||"constant"===o[0].type)d=d.replace("${"+n+"}",o[0].current.value);else if("query"===o[0].type||"custom"===o[0].type){let e=o[0].options[o[0].includeAll?l+1:l];e.selected&&(d=d.replace("${"+n+"_"+l+"}",e.value))}}}i.push(g+"_"+e);let p=""!==d?d:"None"!==e?o+"_"+e:o;u.push(g),c.push(this.nameTypeMaps[o]),m.push(p),"None"===e&&0===r?s.Data.variablesIdsList.push(g):0!==r?(s.AggregateTrend.variablesIdsList.push(g),s.AggregateTrend.aggregateModesList.push(e)):-1===["None","MinMaxTrend","Gantt","GanttView","StepDuration","ValueChanges"].indexOf(e)&&0===r&&(s.Aggregate.variablesIdsList.push(g),s.Aggregate.aggregateModesList.push(e))}}n({queryGroups:s,queryVarNameList:i,queryVarIdList:u,queryVarTypeList:c,fieldNames:m})}))}generateWhereClause(e,t,a){return new Promise(((r,l)=>{let n=[!1];for(let r=0;r<e.items.length;r++){let l=e.items[r];if(""!==l.element1){if(""!==l.element2&&(n[r]=!0),l.element1.startsWith("${")&&l.element1.endsWith("}")){let e=l.element1.substring(2,l.element1.length-1).split("_"),t=e.length>1?Number(e[e.length-1]):0,o=e.length>1?e.slice(0,-1).join("_"):e[0],s=a.filter((e=>e.name===o));if(s.length>0){if("textbox"===s[0].type||"constant"===s[0].type)l.element1=s[0].current.value;else if("query"===s[0].type||"custom"===s[0].type){let e=s[0].options[s[0].includeAll?t+1:t];e.selected&&(l.element1=e.value)}}else n[r]=!1}l.element1=this.nameIdMaps[l.element1],void 0===l.element1&&(n[r]=!1);let e=l.element2.indexOf("${"),o=l.element2.indexOf("}");if(-1!==e&&-1!==o){let t=l.element2.substring(e+2,o).split("_"),s=t.length>1?Number(t[t.length-1]):0,i=t.length>1?t.slice(0,-1).join("_"):t[0],u=a.filter((e=>e.name===i));if(u.length>0)if("textbox"===u[0].type||"constant"===u[0].type)l.element2=l.element2.replace("${"+i+"}",u[0].current.value);else if("query"===u[0].type||"custom"===u[0].type){let e=u[0].options[u[0].includeAll?s+1:s];e.selected?l.element2=l.element2.replace("${"+i+"_"+s+"}",e.value):n[r]=!1}}-1===t.indexOf(l.element1)&&(n[r]=!1)}}r({whereClauseActiveCheck:n.every((e=>!0===e)),whereClauseActive:n,queryWhere:e})}))}formatQueryResult(t,a,r,l,n,o,s,i,u,c,m){return new Promise(((g,d)=>{if(a){let g=[],d=[],p={},v={};r.map((e=>{p[e]=[],v[e]=[]}));let h=Array.from({length:a.timeBuffer.length},((e,t)=>t));h="Ascending"===o?h.sort(((e,t)=>+new Date(a.timeBuffer[e])-+new Date(a.timeBuffer[t]))):h.sort(((e,t)=>+new Date(a.timeBuffer[t])-+new Date(a.timeBuffer[e]))),g=h.map((e=>a.timeBuffer[e]));for(let e=0;e<r.length;e++)p[r[e]]=h.map((t=>a.dataBuffer[r[e]][t]));if(i){let e=[],t=c.items.filter(((e,t)=>u[t]&&s.Aggregate.variablesIdsList.includes(e.element1))).map((e=>e.element1)),a=t.map((e=>l.indexOf(e))).map((e=>p[r[e]][p[r[e]].length-1]));for(let n=0;n<g.length;n++){let o=[];for(let s=0;s<c.items.length;s++)if(u[s]){o[s]=!1;let i=l.indexOf(c.items[s].element1);if(-1!==i){let l=p[r[i]][n],u=t.indexOf(c.items[s].element1);void 0===l&&-1!==u&&(l=a[u]),void 0===l&&!0===e[s]||void 0===l&&n===g.length-1?o[s]=!0:o[s]=this.applyWhereClause(l,c.items[s].comparator,c.items[s].element2)}e=o}let i=o[0];for(let e=1;e<o.length;e++)i="and"===c.operators[e]?i&&o[e]:i||o[e];if(i||n===g.length-1)if(i){d.push(g[n]);for(let e=0;e<r.length;e++)v[r[e]].push(p[r[e]][n])}else if(n===g.length-1&&s.Aggregate.variablesIdsList.length>0&&s.Data.variablesIdsList.length>0&&(t.map((e=>o[c.items.map((e=>e.element1)).indexOf(e)])).includes(!0)||0===t.length)){d.push(g[n]);for(let e=0;e<r.length;e++)s.Aggregate.variablesIdsList.includes(l[e])&&(o[c.items.map((e=>e.element1)).indexOf(l[e])]||0===t.length)&&v[r[e]].push(p[r[e]][n])}}}else v=p,d=g;t[0]={name:"Time",type:e.FieldType.time,values:d};for(let a=0;a<r.length;a++)t.push({name:m[a],type:"String"===n[a]?e.FieldType.string:e.FieldType.number,values:v[r[a]]})}g({fields:t})}))}metricFindQuery(e,a){var r=this;return y((function*(){let l=[],n=!1;if(r.isRemote?(((new Date).getTime()>r.remoteTokenExpire||""===r.remoteToken)&&(yield r.getRemoteToken(),yield r.createAssetMap(),yield r.createVariablesMap(),yield r.createVariablesOptions()),""!==r.remoteToken&&(n=!0)):n=!0,n){let n=e.variablesNamesList||[],o=(0,t.getTemplateSrv)().replace(e.from,a.scopedVars),s=(0,t.getTemplateSrv)().replace(e.to,a.scopedVars),i="Descending"===e.order?"Descending":"Ascending",u=e.aliasesList,c=e.aggregateModesList,m=r.aggregateTimeMap[e.aggregateTime],g=e.where||{items:[],operators:[]},d=(0,t.getTemplateSrv)().getVariables(),p=yield r.createQueryProperties(n,d,c,m,u),v=p.queryGroups,h=p.queryVarNameList,f=p.queryVarIdList,b=p.queryVarTypeList,y=p.fieldNames,w=yield r.generateWhereClause(g,f,d),O=w.whereClauseActiveCheck,T=w.whereClauseActive;if(g=w.queryWhere,new Date(o).getTime()>0&&new Date(s).getTime()>0&&new Date(o).getTime()<new Date(s).getTime()&&y.length>0){o=new Date(o).toISOString(),s=new Date(s).getTime()>(new Date).getTime()?(new Date).toISOString():new Date(s).toISOString();let e={};h.map((t=>e[t]=[]));let t=[];const a=yield r.queryLoop(t,e,v,o,s,i,m);l=(yield r.formatQueryResult(l,a,h,f,b,i,v,O,T,g,y)).fields[1].values.map((e=>({text:e})))}}return l}))()}customRequest(e,a,r,l,n="json",s){var i=this;return y((function*(){const u=O({},i.headers,a);if("get"!==r){let a=(0,t.getBackendSrv)().fetch({url:`${e}${(null==s?void 0:s.length)?`?${s}`:""}`,headers:u,method:r,data:l,responseType:n});return(0,o.lastValueFrom)(a)}return i.customGetRequest(e,a,n,s)}))()}customGetRequest(e,a,r="json",l=""){var n=this;return y((function*(){const s=O({},n.headers,a);let i=(0,t.getBackendSrv)().fetch({url:`${e}${(null==l?void 0:l.length)?`?${l}`:""}`,headers:s,method:"get",responseType:r});return(0,o.lastValueFrom)(i)}))()}delay(e){return new Promise((t=>setTimeout(t,e)))}testDatasource(){var e=this;return y((function*(){let t="Cannot connect to local IIH Essentials, check if the app is running.";try{let a="",r={};e.isRemote?(a=e.apiUrl+"/iih-essentials",""===e.remoteToken&&(yield e.getRemoteToken()),r={"x-grafana-remotedevice":e.remoteConfigUrl,"x-grafana-remotetoken":e.remoteToken}):a=e.apiUrl;const l=yield e.customGetRequest(a,r,"text");return 200===l.status?{status:"success",message:"Success"}:{status:"error",message:l.statusText?l.statusText:t}}catch(e){if(r().isString(e))return{status:"error",message:e};{let a="";return a+=e.statusText?e.statusText:t,console.log("testdatasource error:",e),{status:"error",message:a}}}}))()}constructor(e){super(e),w(this,"baseUrl",void 0),w(this,"isRemote",void 0),w(this,"remoteConfigUrl",void 0),w(this,"remoteUser",void 0),w(this,"remotePassword",void 0),w(this,"remoteRoute",void 0),w(this,"localRoute",void 0),w(this,"apiUrl",void 0),w(this,"remoteToken",void 0),w(this,"remoteTokenExpire",void 0),w(this,"getRemoteTokenBody",void 0),w(this,"headers",void 0),w(this,"nameIdMaps",void 0),w(this,"idNameMaps",void 0),w(this,"nameTypeMaps",void 0),w(this,"idAssetMaps",void 0),w(this,"variablesOptions",void 0),w(this,"variablesOptionsCascader",void 0),w(this,"aggregateBaseBody",void 0),w(this,"aggregateTimeMap",void 0),w(this,"start",void 0),this.baseUrl=e.url,this.remoteConfigUrl=e.jsonData.remoteUrl,this.isRemote=e.jsonData.isRemote,this.remoteUser=e.jsonData.remoteUser,this.remotePassword=e.jsonData.remotePassword,this.localRoute="/edgeappdataservice",this.remoteRoute="/iihadapter",this.apiUrl="",this.headers={"Content-Type":"application/json",accept:"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"*"},this.remoteToken="",this.remoteTokenExpire=0,this.getRemoteTokenBody={userName:this.remoteUser,passWord:this.remotePassword},this.aggregateBaseBody={from:"",to:"",dataSources:[]},this.aggregateTimeMap=f,this.nameIdMaps={},this.idNameMaps={},this.nameTypeMaps={},this.idAssetMaps={},this.variablesOptions=[],this.variablesOptionsCascader=[],this.start=0,this.initPlugin()}}var x=i(5959),D=i.n(x),P=i(2007);function E(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function N(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),r.forEach((function(t){E(e,t,a[t])}))}return e}function L(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);a.push.apply(a,r)}return a}(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))})),e}function S(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function I(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),r.forEach((function(t){S(e,t,a[t])}))}return e}function A(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);a.push.apply(a,r)}return a}(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))})),e}function M(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function C(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{},r=Object.keys(a);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(a).filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable})))),r.forEach((function(t){M(e,t,a[t])}))}return e}function q(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);a.push.apply(a,r)}return a}(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))})),e}const k=new e.DataSourcePlugin(j).setConfigEditor((function(e){const{onOptionsChange:t,options:a}=e,{jsonData:r}=a;return D().createElement("div",{className:"gf-form-group"},D().createElement(P.InlineField,{label:"IIH Essentials on a remote IED?",labelWidth:48,tooltip:"Is IIH Essentials App installed on a different IED?"},D().createElement(P.InlineSwitch,{label:"Remote IED",showLabel:!0,value:r.isRemote,onChange:e=>{const r=L(N({},a.jsonData),{isRemote:Boolean(e.target.checked)});t(L(N({},a),{jsonData:r}))}})),D().createElement(P.InlineField,{label:"Remote IED URL",labelWidth:25,disabled:!r.isRemote,tooltip:"If IIH Essentials is installed on  a Remote IED then insert here its IP or FQDN (e.g. )."},D().createElement(P.Input,{onChange:e=>{const r=L(N({},a.jsonData),{remoteUrl:e.target.value});t(L(N({},a),{jsonData:r}))},value:r.remoteUrl||"",placeholder:"Insert IP Address or FQDN of Remote IED",width:40})),D().createElement(P.InlineField,{label:"Remote IED User",labelWidth:25,disabled:!r.isRemote,tooltip:"IED Login User that can access  Remote IED where IIH Essentials App is installed."},D().createElement(P.Input,{onChange:e=>{const r=L(N({},a.jsonData),{remoteUser:e.target.value});t(L(N({},a),{jsonData:r}))},value:r.remoteUser||"",width:40})),D().createElement(P.InlineField,{label:"Remote IED Password",labelWidth:25,disabled:!r.isRemote,tooltip:"IED Login User that can access  Remote IED where IIH Essentials App is installed."},D().createElement(P.SecretInput,{onChange:e=>(e=>{const r=L(N({},a.jsonData),{remotePassword:e.target.value});t(L(N({},a),{jsonData:r}))})(e),onReset:()=>"",isConfigured:!1,value:r.remotePassword||"",width:40})))})).setQueryEditor((function({query:e,onChange:t,onRunQuery:a,datasource:l}){const o=e=>{u().then((e=>{e&&a()}))},i=e=>{u().then((e=>{e&&a()}))},u=()=>new Promise(((t,a)=>{let r=!0;""===(e.from||"")&&(r=!1,console.log("from is invalid")),""===(e.to||"")&&(r=!1,console.log("to is invalid")),0===e.variablesNamesList.length&&(r=!1,console.log("variablesNamesList is invalid")),e.variablesNamesList.length!==e.aggregateModesList.length&&(r=!1,console.log("variablesNamesList and aggregateModesList are not equal length")),e.variablesNamesList.length!==e.aliasesList.length&&(r=!1,console.log("variablesNamesList and aliasesList are not equal length")),e.variablesNamesList.includes("")&&(r=!1,console.log("variablesNamesList includes empty strings")),t(r)})),{from:c,to:f,order:b,variablesNamesList:y,variablesOptions:w,aliasesList:O,aggregateModesList:T,aggregateTime:j,where:x,variablesNamesListOptions:E}=n()(e,s);return D().createElement(D().Fragment,null,D().createElement("div",{className:"gf-form"},D().createElement(P.InlineField,{label:"From",labelWidth:20,tooltip:"Start datetime for query.",invalid:""===(c||""),error:""===(c||"")?"Please insert a valid query start time.":""},D().createElement(P.Input,{width:30,onChange:r=>{e=A(I({},e),{from:r.target.value}),t(I({},e)),u().then((e=>{e&&a()}))},value:c||"",type:"text"})),D().createElement(P.InlineField,{label:"To",labelWidth:20,tooltip:"End datetime for query.",invalid:""===(f||""),error:""===(f||"")?"Please insert a valid query end time.":""},D().createElement(P.Input,{width:30,onChange:r=>{e=A(I({},e),{to:r.target.value}),t(I({},e)),u().then((e=>{e&&a()}))},value:f||"${__from:date}",type:"text"}))),D().createElement("div",{className:"gf-form"},D().createElement(P.InlineLabel,{width:50,tooltip:"Variables Names to be queried from database."},"Variables"),D().createElement(P.InlineLabel,{width:20,tooltip:"Aggregation function applied on data. When Aggregate Time is set to None the following  aggregation functions are not available:  MinMaxTrend, Gantt, GanttView, StepDuration, ValueChanges."},"Acquisition Mode"),D().createElement(P.InlineLabel,{width:30,tooltip:"Aliases to be applied on the Variables Names."},"Aliases")),D().createElement("div",null,T.map(((n,s)=>D().createElement("div",{className:"gf-form",key:s},D().createElement(P.Select,{width:50,menuPlacement:"top",allowCustomValue:!1,options:w,onOpenMenu:()=>{l.createVariablesOptions().then((a=>{e=A(I({},e),{variablesOptions:a}),t(I({},e))}))},value:w.find((e=>e.value===y[s])),onChange:l=>((l,n)=>{let o=void 0!==l.value?l.value:"",s=r().cloneDeep(e.variablesNamesList);s[n]=o,e=A(I({},e),{variablesNamesList:s}),t(I({},e)),u().then((e=>{e&&a()}))})(l,s)}),D().createElement(P.Select,{width:20,menuPlacement:"top",allowCustomValue:!1,options:"None"===j?v:p,value:"None"===j?v.find((e=>e.value===n)):p.find((e=>e.value===n)),onChange:l=>((l,n)=>{let o=void 0!==l.value?l.value:"None",s=r().cloneDeep(e.aggregateModesList);s[n]=o,e=A(I({},e),{aggregateModesList:s}),t(I({},e)),u().then((e=>{e&&a()}))})(l,s)}),D().createElement(P.Input,{width:30,onChange:a=>((a,l)=>{let n=void 0!==a.target.value?a.target.value:"",o=r().cloneDeep(e.aliasesList);o[l]=n,e=A(I({},e),{aliasesList:o}),t(I({},e))})(a,s),onBlur:o,value:O[s],placeholder:"Insert an Alias Name for the Variable",type:"text"}),D().createElement(P.InlineField,{label:"",labelWidth:10,grow:!0,style:{alignItems:"center",flex:1}},0===s&&1===T.length?D().createElement("span",null):D().createElement(P.IconButton,{name:"trash-alt",size:"xl",variant:"destructive",onClick:l=>((l,n)=>{let o=r().cloneDeep(e.variablesNamesList);o.splice(n,1);let s=r().cloneDeep(e.aggregateModesList);s.splice(n,1);let i=r().cloneDeep(e.aliasesList);i.splice(n,1),e=A(I({},e),{variablesNamesList:o,aggregateModesList:s,aliasesList:i}),t(I({},e)),u().then((e=>{e&&a()}))})(0,s)})))))),D().createElement("div",{className:"gf-form"},D().createElement(P.InlineField,{label:"",labelWidth:10,grow:!0,style:{alignItems:"center",flex:1}},D().createElement(P.IconButton,{name:"plus",size:"xl",variant:"secondary",onClick:a=>{let l=r().cloneDeep(e.variablesNamesList);l.push("");let n=r().cloneDeep(e.aggregateModesList);n.push("None");let o=r().cloneDeep(e.aliasesList);o.push(""),e=A(I({},e),{variablesNamesList:l,aggregateModesList:n,aliasesList:o}),t(I({},e))}}))),D().createElement("div",{className:"gf-form"},D().createElement(P.InlineLabel,{width:100,tooltip:"A where clause to be applied on the query."},"Where")),D().createElement("div",null,x.items.map(((l,n)=>D().createElement("div",{className:"gf-form",key:n},n>0?D().createElement(P.Select,{width:10,menuPlacement:"top",allowCustomValue:!1,options:g,value:g.find((e=>e.value===x.operators[n])),onChange:l=>((l,n)=>{let o=void 0!==l.value?l.value:"",s=r().cloneDeep(e.where);s.operators[n]=o,e=A(I({},e),{where:s}),t(I({},e)),u().then((e=>{e&&a()}))})(l,n)}):D().createElement(P.InlineLabel,{width:9.5},"​"),D().createElement(P.Select,{width:50,menuPlacement:"top",allowCustomValue:!1,options:E,onOpenMenu:()=>(a=>{let r=e.variablesNamesList.filter(((e,t,a)=>a.indexOf(e)===t)),l=r.map((e=>({label:e,value:e})));e=A(I({},e),{variablesNamesListOptions:l}),t(I({},e))})(),value:y.find((e=>e===l.element1)),onChange:l=>((l,n)=>{let o=void 0!==l.value?l.value:"",s=r().cloneDeep(e.where);s.items[n].element1=o,e=A(I({},e),{where:s}),t(I({},e)),u().then((e=>{e&&a()}))})(l,n)}),D().createElement(P.Select,{width:17,menuPlacement:"top",allowCustomValue:!1,options:m,value:m.find((e=>e.value===l.comparator)),onChange:l=>((l,n)=>{let o=void 0!==l.value?l.value:"=",s=r().cloneDeep(e.where);s.items[n].comparator=o,e=A(I({},e),{where:s}),t(I({},e)),u().then((e=>{e&&a()}))})(l,n)}),D().createElement(P.Input,{width:23,onChange:a=>((a,l)=>{let n=void 0!==a.target.value?a.target.value:"",o=r().cloneDeep(e.where);o.items[l].element2=n,e=A(I({},e),{where:o}),t(I({},e))})(a,n),onBlur:i,value:l.element2,type:"text"}),D().createElement(P.InlineField,{label:"",labelWidth:10,grow:!0,style:{alignItems:"center",flex:1}},D().createElement(P.IconButton,{name:"trash-alt",size:"xl",variant:"destructive",onClick:l=>((l,n)=>{let o=r().cloneDeep(e.where);o.items.splice(n,1),o.operators.splice(n,1),t(A(I({},e),{where:o})),u().then((e=>{e&&a()}))})(0,n)})))))),D().createElement("div",{className:"gf-form"},D().createElement(P.InlineField,{label:"",labelWidth:10,grow:!0,style:{alignItems:"center",flex:1}},D().createElement(P.IconButton,{name:"plus",size:"xl",variant:"secondary",onClick:a=>{let l=r().cloneDeep(e.where);l.items.push({element1:"",comparator:"=",element2:""}),l.operators.push(l.items.length>1?"and":""),e=A(I({},e),{where:l}),t(I({},e))}}))),D().createElement("div",{className:"gf-form"},D().createElement(P.InlineField,{label:"Aggregate Time",labelWidth:20,tooltip:"Time groups for data aggregation. Using None will return raw values."},D().createElement(P.Select,{width:20,menuPlacement:"top",allowCustomValue:!1,options:h,value:h.find((e=>e.value===j)),onChange:r=>{let l=void 0!==r.value?r.value:"None";e=A(I({},e),{aggregateTime:l}),t(I({},e)),u().then((e=>{e&&a()}))}})),D().createElement(P.InlineField,{label:"Order",labelWidth:20,onLoad:a,tooltip:"Data ordering could be Ascending or Descending."},D().createElement(P.Select,{width:20,menuPlacement:"bottom",allowCustomValue:!1,options:d,value:d.find((e=>e.value===b)),onChange:r=>{let l=void 0!==r.value?r.value:"Ascending";e=A(I({},e),{order:l}),t(I({},e)),u().then((e=>{e&&a()}))}}))))})).setVariableQueryEditor((({onChange:e,query:t,datasource:a})=>{var l,o,s;const i=e=>{m=q(C({},m),{[e.currentTarget.name]:e.currentTarget.value}),g(C({},m)),u()},u=()=>{new Promise(((e,t)=>{let a=!0;""===(m.from||"")&&(a=!1,console.log("from is invalid")),""===(m.to||"")&&(a=!1,console.log("to is invalid")),0===m.variablesNamesList.length&&(a=!1,console.log("variablesNamesList is invalid")),m.variablesNamesList.length!==m.aggregateModesList.length&&(a=!1,console.log("variablesNamesList and aggregateModesList are not equal length")),m.variablesNamesList.includes("")&&(a=!1,console.log("variablesNamesList includes empty strings")),e(a)})).then((t=>{t&&e(m)}))};let[m,g]=(0,x.useState)(n()(t,c));return D().createElement(D().Fragment,null,D().createElement("div",{className:"gf-form"},D().createElement("span",{className:"gf-form-label width-10"},"From"),D().createElement("input",{name:"from",className:"gf-form-input width-20",onChange:i,value:m.from||"${__from:date}"})),D().createElement("div",{className:"gf-form"},D().createElement("span",{className:"gf-form-label width-10"},"To"),D().createElement("input",{name:"to",className:"gf-form-input width-20",onChange:i,value:m.to||"${__to:date}"})),D().createElement("div",{className:"gf-form"},D().createElement("span",{className:"gf-form-label width-10"},"Variable"),D().createElement("select",{className:"gf-form-select-wrapper width-30",onChange:e=>{let t=void 0!==e.currentTarget.value?e.currentTarget.value:"",a=r().cloneDeep(m.variablesNamesList);a[0]=t,m=q(C({},m),{variablesNamesList:a}),g(C({},m)),u()},onFocus:()=>{a.createVariablesOptions().then((e=>{e=e.filter((e=>"Grafana Variables"!==e.label)),g(q(C({},m),{variablesOptions:e}))}))},value:(null===(l=m.variablesOptions.find((e=>e.value===m.variablesNamesList[0])))||void 0===l?void 0:l.value)||""},m.variablesOptions.map(((e,t)=>D().createElement("option",{key:t,value:e.value},e.label))))),D().createElement("div",{className:"gf-form"},D().createElement("span",{className:"gf-form-label width-10"},"Acquisition Mode"),D().createElement("select",{className:"gf-form-select-wrapper width-20",onChange:e=>{let t=void 0!==e.currentTarget.value?e.currentTarget.value:"None",a=r().cloneDeep(m.aggregateModesList);a[0]=t,m=q(C({},m),{aggregateModesList:a}),g(C({},m)),u()},value:(null===(o=v.find((e=>e.value===m.aggregateModesList[0])))||void 0===o?void 0:o.value)||""},v.map(((e,t)=>D().createElement("option",{key:t,value:e.value},e.label))))),D().createElement("div",{className:"gf-form"},D().createElement("span",{className:"gf-form-label width-10"},"Aggregate Time"),D().createElement("select",{className:"gf-form-select-wrapper width-20",onChange:e=>{let t=void 0!==e.currentTarget.value?e.currentTarget.value:"None";m=q(C({},m),{aggregateTime:t}),g(C({},m)),u()},value:(null===(s=h.find((e=>e.value===m.aggregateTime)))||void 0===s?void 0:s.value)||""},h.map(((e,t)=>D().createElement("option",{key:t,value:e.value},e.label))))))}))})(),u})()));
//# sourceMappingURL=module.js.map